#!/usr/bin/awk -f

BEGIN { 
        n=0 ; 
        hostname[n]=""; 
        ip[n]=""; 
        file="/tmp/generated.ssh.config"; 
        printf "#File locally generated by script\n" > file
}

/^$/ { next; }
$2 ~ /ansible_ssh_host=/ { 
        host=tolower($1);
        gsub(/#/, "", host);
        hostname[n]=host; 
        split($2,b,"="); 
        plop=b[2]; 
        gsub(/"/, "", plop); 
        ip[n]=plop ; 
        n++; 
        next; 
}

END {
        for(s=0; s<n; s++){
               printf "Host %s\n      HostName %s\n      User root\n\n", hostname[s], ip[s] > file;      
        }
        printf "Host * \n" > file;
        printf "    User root \n" > file;
        printf "    GSSAPIAuthentication yes \n" > file;
        printf "    ForwardAgent yes \n" > file;
        printf "    AddressFamily inet \n" > file;
        printf "        SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES \n" > file;
        printf "        SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT \n" > file;
        printf "        SendEnv LC_IDENTIFICATION LC_ALL LANGUAGE \n" > file;
        printf "        SendEnv XMODIFIERS \n" > file;
        printf "        # Avoid error with known hosts \n" > file;
        printf "        UserKnownHostsFile=/dev/null \n" > file;
        printf "        StrictHostKeyChecking no \n" > file;

        printf " Save your old config file : mv ~/.ssh/config{,.old} \n"
        printf " Install the new generated file : cp /tmp/generated.ssh.config ~/.ssh/config \n"
        printf " Enjoy !!!!! :)\n"
}
